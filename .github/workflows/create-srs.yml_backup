name: Create srs

on:
  push:
    branches: [ "main" ]
    paths:
      - categories/CIDR4/summary.lst
      - domains.lst
  workflow_dispatch:

permissions:
  contents: write

jobs:
  generate-lists:
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v4.2.2

      - name: Compile ruleset srs
        run: |
          docker run --rm \
          -v ${{ github.workspace }}:/app \
          itdoginfo/compilesrs:0.1.11 \
          python3 /app/scripts/convert.py

      - name: Move generated file to categories/SRS
        run: |
          mkdir -p ${{ github.workspace }}/categories/SRS
          mv ${{ github.workspace }}/domains-cidr4.srs ${{ github.workspace }}/categories/SRS/

      - name: Commit and push changes
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add categories/SRS/domains-cidr4.srs
          git commit -m "Update SRS ruleset on $(date +'%d.%m.%Y %H:%M')" || echo "No changes to commit"
          git push
